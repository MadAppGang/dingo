package main

type StringOptionTag uint8

const (
	StringOptionTagSome StringOptionTag = iota
	StringOptionTagNone
)

type StringOption struct {
	tag  StringOptionTag
	some *string
}

func StringOptionSome(arg0 string) StringOption {
	return StringOption{tag: StringOptionTagSome, some: &arg0}
}
func StringOptionNone() StringOption {
	return StringOption{tag: StringOptionTagNone}
}
func (e StringOption) IsSome() bool {
	return e.tag == StringOptionTagSome
}
func (e StringOption) IsNone() bool {
	return e.tag == StringOptionTagNone
}
func (o StringOption) Map(fn func(string) string) StringOption {
	switch o.tag {
	case StringOptionTagSome:
		if o.some != nil {
			return StringOptionSome(fn(*o.some))
		}
	case StringOptionTagNone:
		return o
	}
	panic("invalid StringOption state")
}
func (o StringOption) AndThen(fn func(string) StringOption) StringOption {
	switch o.tag {
	case StringOptionTagSome:
		if o.some != nil {
			return fn(*o.some)
		}
	case StringOptionTagNone:
		return o
	}
	panic("invalid StringOption state")
}
func main() {

	firstName := StringOptionNone()
	middleName := StringOptionNone()
	lastName := StringOptionSome("Smith")

	name := func() __INFER__ {
		coalesce1 := firstName
		if coalesce1.IsSome() {
			return coalesce1.Unwrap()
		}
		coalesce2 := middleName
		if coalesce2.IsSome() {
			return coalesce2.Unwrap()
		}
		coalesce3 := lastName
		if coalesce3.IsSome() {
			return coalesce3.Unwrap()
		}
		return "Unknown"
	}()

	primary := getConfig("primary")
	fallback := getConfig("fallback")
	config := func() __INFER__ {
		coalesce4 := primary
		if __IS_SOME__(coalesce4) {
			return __UNWRAP__(coalesce4)
		}
		coalesce5 := fallback
		if __IS_SOME__(coalesce5) {
			return __UNWRAP__(coalesce5)
		}
		return "default"
	}()

	opt1 := StringOptionNone()
	opt2 := StringOptionNone()
	opt3 := StringOptionNone()
	opt4 := StringOptionSome("Found")
	result := func() __INFER__ {
		coalesce6 := opt1
		if coalesce6.IsSome() {
			return coalesce6.Unwrap()
		}
		coalesce7 := opt2
		if coalesce7.IsSome() {
			return coalesce7.Unwrap()
		}
		coalesce8 := opt3
		if coalesce8.IsSome() {
			return coalesce8.Unwrap()
		}
		coalesce9 := opt4
		if coalesce9.IsSome() {
			return coalesce9.Unwrap()
		}
		return "Not Found"
	}()

	println("Name:", name)
	println("Config:", config)
	println("Result:", result)
}
func getConfig(key string) StringOption {
	if key == "fallback" {
		return StringOptionSome("backup-value")
	}
	return StringOptionNone()
}
