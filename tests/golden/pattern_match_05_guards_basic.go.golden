package main

type ResultTag uint8

const (
	ResultTagOk ResultTag = iota
	ResultTagErr
)

type Result struct {
	tag ResultTag
	err *error
	ok  *int
}

func ResultOk(arg0 int) Result {
	return Result{tag: ResultTagOk, ok: &arg0}
}
func ResultErr(arg0 error) Result {
	return Result{tag: ResultTagErr, err: &arg0}
}
func (e Result) IsOk() bool {
	return e.tag == ResultTagOk
}
func (e Result) IsErr() bool {
	return e.tag == ResultTagErr
}
func (r Result) Map(fn func(int) int) Result {
	switch r.tag {
	case ResultTagOk:
		if r.ok != nil {
			return ResultOk(fn(*r.ok))
		}
	case ResultTagErr:
		return r
	}
	panic("invalid Result state")
}
func (r Result) AndThen(fn func(int) Result) Result {
	switch r.tag {
	case ResultTagOk:
		if r.ok != nil {
			return fn(*r.ok)
		}
	case ResultTagErr:
		return r
	}
	panic("invalid Result state")
}

// Simple guard on Result type
func classifyNumber(result Result) string {
	var result interface{}

	scrutinee := result
	switch scrutinee.tag {
	case ResultTagOk:
		x := *scrutinee.ok

		if x > 0 {
			result = "positive"

		} else if x < 0 {
			result = "negative"

		} else {
			result = "zero"
		}
	case ResultTagErr:
		e := *scrutinee.err

		result = "error"
	}
	panic("unreachable: match is exhaustive")
	return result

}

// Guard with multiple conditions
func validateAge(result Result) string {
	var result2 interface{}

	scrutinee2 := result
	switch scrutinee2.tag {
	case ResultTagOk:
		age := *scrutinee2.ok

		if age >= 18 && age < 65 {
			result2 = "adult"

		} else if age >= 65 {
			result2 = "senior"

		} else {
			result2 = "minor"
		}
	case ResultTagErr:

		result2 = "invalid"
	}
	panic("unreachable: match is exhaustive")
	return result2

}

// Guard with function call
func checkLength(result Result) string {
	var result3 interface{}

	scrutinee3 := result
	switch scrutinee3.tag {
	case ResultTagOk:
		n := *scrutinee3.ok

		if isEven(n) {
			result3 = "even"

		} else {
			result3 = "odd"
		}
	case ResultTagErr:

		result3 = "error"
	}
	panic("unreachable: match is exhaustive")
	return result3

}
func isEven(n int) bool {
	return n%2 == 0
}
func main() {
	println(classifyNumber(ResultOk(42)))
	println(validateAge(ResultOk(25)))
	println(checkLength(ResultOk(10)))
}
